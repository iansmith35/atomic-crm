<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>CEO Office - Strategic Command</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="config.js"></script>
</head>
<body class="bg-gray-900 text-white min-h-screen">
    <div class="max-w-6xl mx-auto p-6">
        <!-- Header -->
        <div class="bg-gradient-to-r from-purple-600 to-pink-600 rounded-xl p-6 mb-8">
            <div class="flex items-center justify-between">
                <div>
                    <h1 class="text-3xl font-bold flex items-center">
                        üíº CEO Office - Strategic Command
                    </h1>
                    <p class="text-purple-100 mt-2">Executive oversight & global business operations</p>
                </div>
                <div class="text-right">
                    <div class="text-2xl font-bold">9</div>
                    <div class="text-sm text-purple-200">Offices Online</div>
                </div>
            </div>
        </div>

        <div class="grid md:grid-cols-2 gap-8">
            <!-- Secret Management -->
            <div class="bg-gray-800 rounded-xl p-6">
                <h2 class="text-xl font-bold mb-4">üîê Secret & API Key Management</h2>
                <div class="space-y-4">
                    <div class="bg-gray-700 rounded-lg p-4">
                        <h3 class="font-semibold mb-2">Google OAuth</h3>
                        <div class="flex items-center justify-between">
                            <span class="text-sm text-gray-300">Gmail & Calendar Integration</span>
                            <span class="text-green-400">‚úÖ Active</span>
                        </div>
                    </div>
                    <div class="bg-gray-700 rounded-lg p-4">
                        <h3 class="font-semibold mb-2">OpenAI API</h3>
                        <div class="flex items-center justify-between">
                            <span class="text-sm text-gray-300">ChatGPT Bot Integration</span>
                            <span class="text-yellow-400">üîß Pending</span>
                        </div>
                    </div>
                    <div class="bg-gray-700 rounded-lg p-4">
                        <h3 class="font-semibold mb-2">Supabase Keys</h3>
                        <div class="flex items-center justify-between">
                            <span class="text-sm text-gray-300">Database & Functions</span>
                            <span class="text-green-400">‚úÖ Active</span>
                        </div>
                    </div>
                </div>
                <button onclick="manageSecrets()" 
                        class="w-full mt-4 bg-purple-600 hover:bg-purple-700 py-2 rounded-lg font-semibold">
                    üîë Manage Secrets
                </button>
            </div>

            <!-- Office Performance -->
            <div class="bg-gray-800 rounded-xl p-6">
                <h2 class="text-xl font-bold mb-4">üìä Office Performance</h2>
                <div class="space-y-4">
                    <div class="flex justify-between items-center">
                        <span>IT Office (Rube)</span>
                        <div class="flex items-center">
                            <div class="w-16 bg-gray-600 rounded-full h-2 mr-3">
                                <div class="bg-blue-500 h-2 rounded-full" style="width: 85%"></div>
                            </div>
                            <span class="text-blue-400">85%</span>
                        </div>
                    </div>
                    <div class="flex justify-between items-center">
                        <span>Communications (Stacy)</span>
                        <div class="flex items-center">
                            <div class="w-16 bg-gray-600 rounded-full h-2 mr-3">
                                <div class="bg-green-500 h-2 rounded-full" style="width: 92%"></div>
                            </div>
                            <span class="text-green-400">92%</span>
                        </div>
                    </div>
                    <div class="flex justify-between items-center">
                        <span>Accounts (Philip)</span>
                        <div class="flex items-center">
                            <div class="w-16 bg-gray-600 rounded-full h-2 mr-3">
                                <div class="bg-emerald-500 h-2 rounded-full" style="width: 78%"></div>
                            </div>
                            <span class="text-emerald-400">78%</span>
                        </div>
                    </div>
                    <div class="flex justify-between items-center">
                        <span>Virtual Engineer</span>
                        <div class="flex items-center">
                            <div class="w-16 bg-gray-600 rounded-full h-2 mr-3">
                                <div class="bg-yellow-500 h-2 rounded-full" style="width: 88%"></div>
                            </div>
                            <span class="text-yellow-400">88%</span>
                        </div>
                    </div>
                </div>
                <button onclick="generateReport()" 
                        class="w-full mt-4 bg-pink-600 hover:bg-pink-700 py-2 rounded-lg font-semibold">
                    üìà Generate Executive Report
                </button>
            </div>
        </div>

        <!-- Global Directives -->
        <div class="mt-8 bg-gray-800 rounded-xl p-6">
            <h2 class="text-xl font-bold mb-4">üìã Global Directives & Policies</h2>
            <div class="grid md:grid-cols-2 gap-6">
                <div>
                    <h3 class="font-semibold mb-3">Active Policies</h3>
                    <div class="space-y-2">
                        <div class="bg-green-600 bg-opacity-20 rounded px-3 py-2 text-sm">
                            ‚úÖ All external messages require approval
                        </div>
                        <div class="bg-blue-600 bg-opacity-20 rounded px-3 py-2 text-sm">
                            ‚úÖ Automated task delegation enabled
                        </div>
                        <div class="bg-purple-600 bg-opacity-20 rounded px-3 py-2 text-sm">
                            ‚úÖ Cross-office communication active
                        </div>
                        <div class="bg-yellow-600 bg-opacity-20 rounded px-3 py-2 text-sm">
                            ‚è≥ Philip accounting migration (in progress)
                        </div>
                    </div>
                </div>
                <div>
                    <h3 class="font-semibold mb-3">System Controls</h3>
                    <div class="space-y-3">
                        <button onclick="toggleOffice('communications')" 
                                class="w-full bg-gray-700 hover:bg-gray-600 py-2 rounded text-sm">
                            Toggle Communications Office
                        </button>
                        <button onclick="escalateAllTasks()" 
                                class="w-full bg-orange-600 hover:bg-orange-700 py-2 rounded text-sm">
                            Escalate All Pending Tasks
                        </button>
                        <button onclick="emergencyMode()" 
                                class="w-full bg-red-600 hover:bg-red-700 py-2 rounded text-sm">
                            üö® Emergency Mode
                        </button>
                    </div>
                </div>
            </div>
        </div>

        <!-- CEO Task View -->
        <div class="mt-8 bg-gray-800 rounded-xl p-6">
            <h2 class="text-xl font-bold mb-4">üß† CEO Task View</h2>
            <div class="max-h-48 overflow-y-auto border border-gray-600 rounded-lg p-2 bg-gray-700">
                <ul id="taskList" class="space-y-3">
                    <!-- Tasks will be loaded dynamically -->
                </ul>
            </div>
            <!-- Task Archive Link -->
            <div class="mt-4 pt-4 border-t border-gray-600">
                <a href="task-archive.html" 
                   class="w-full bg-gray-600 hover:bg-gray-500 py-3 rounded-lg font-semibold text-center block transition-colors">
                    üìÅ View Task Archive
                </a>
            </div>
        </div>

        <!-- Rebecca AI Chat -->
        <div class="fixed bottom-4 right-4 w-full max-w-sm bg-white shadow-xl rounded-2xl p-4 border border-gray-200">
            <h3 class="font-bold mb-2 text-gray-800">üí¨ Chat with Rebecca</h3>
            <div id="chatMessages" class="h-48 overflow-y-auto border rounded-lg p-2 mb-2 bg-gray-50 text-sm">
                <div class="text-left text-blue-700 mb-2">
                    <span>Hello! I'm Rebecca, your AI assistant. How can I help you today?</span>
                </div>
            </div>
            <div class="flex gap-2 mb-2">
                <input
                    id="chatInput"
                    class="flex-1 border rounded-xl px-3 py-2 text-sm text-gray-800"
                    placeholder="Ask me anything..."
                />
                <button id="voiceButton" class="bg-green-600 text-white px-3 py-2 rounded-xl text-sm hover:bg-green-700">
                    üé§
                </button>
                <button id="sendButton" class="bg-blue-600 text-white px-4 py-2 rounded-xl text-sm hover:bg-blue-700">
                    Send
                </button>
            </div>
            <div class="flex gap-2">
                <button id="speakButton" class="bg-purple-600 text-white px-3 py-2 rounded-xl text-xs hover:bg-purple-700">
                    üîä Speak Last
                </button>
                <button id="toggleSpeechButton" class="bg-gray-600 text-white px-3 py-2 rounded-xl text-xs hover:bg-gray-700">
                    üîá Auto-speak: OFF
                </button>
            </div>
        </div>

        <!-- Business Metrics -->
        <div class="mt-8 bg-gray-800 rounded-xl p-6">
            <h2 class="text-xl font-bold mb-4">üí∞ Business Overview</h2>
            <div class="grid md:grid-cols-4 gap-4">
                <div class="text-center bg-blue-600 bg-opacity-20 rounded-lg p-4">
                    <div class="text-2xl font-bold text-blue-400">127</div>
                    <div class="text-sm text-gray-300">Messages Today</div>
                </div>
                <div class="text-center bg-green-600 bg-opacity-20 rounded-lg p-4">
                    <div class="text-2xl font-bold text-green-400">¬£4,230</div>
                    <div class="text-sm text-gray-300">Revenue MTD</div>
                </div>
                <div class="text-center bg-purple-600 bg-opacity-20 rounded-lg p-4">
                    <div class="text-2xl font-bold text-purple-400">15</div>
                    <div class="text-sm text-gray-300">Certificates Issued</div>
                </div>
                <div class="text-center bg-yellow-600 bg-opacity-20 rounded-lg p-4">
                    <div class="text-2xl font-bold text-yellow-400">98%</div>
                    <div class="text-sm text-gray-300">System Uptime</div>
                </div>
            </div>
        </div>

        <!-- Back Button -->
        <div class="mt-8 text-center">
            <a href="index.html" class="inline-block bg-gray-700 hover:bg-gray-600 px-6 py-3 rounded-lg font-semibold">
                ‚Üê Back to Office Dashboard
            </a>
        </div>
    </div>

    <script>
        function manageSecrets() {
            alert('üîê Secret Management\n\nAvailable Actions:\n‚Ä¢ Add new API keys\n‚Ä¢ Rotate existing secrets\n‚Ä¢ Update service credentials\n‚Ä¢ Manage access permissions\n\nAll secrets are encrypted and audited for security.');
        }

        function generateReport() {
            alert('üìà Executive Report Generated!\n\nüìä System Performance: 88% Average\nüíº All 9 offices operational\nüìß 127 messages processed today\nüí∞ Revenue on track for monthly targets\nüîí Security: All systems secure\n\nDetailed report sent to your dashboard.');
        }

        function toggleOffice(office) {
            alert(`üè¢ ${office.charAt(0).toUpperCase() + office.slice(1)} Office\n\nOffice is currently ACTIVE\n\nActions available:\n‚Ä¢ Temporarily disable\n‚Ä¢ Change agent assignments\n‚Ä¢ Modify permissions\n‚Ä¢ View detailed metrics`);
        }

        function escalateAllTasks() {
            alert('üö® Task Escalation\n\nEscalating all pending tasks to office leads:\n‚Ä¢ IT Office: 3 tasks ‚Üí Rube AI\n‚Ä¢ Communications: 8 tasks ‚Üí Stacy\n‚Ä¢ Accounts: 2 tasks ‚Üí Philip\n‚Ä¢ Virtual Engineer: 1 task ‚Üí Virtual Ian\n\nAll agents will be notified immediately.');
        }

        function emergencyMode() {
            if (confirm('üö® EMERGENCY MODE\n\nThis will:\n‚Ä¢ Alert all office agents\n‚Ä¢ Escalate all pending tasks\n‚Ä¢ Enable 24/7 monitoring\n‚Ä¢ Require manual approval for all actions\n\nActivate Emergency Mode?')) {
                alert('üö® EMERGENCY MODE ACTIVATED\n\nAll offices have been notified.\nSwitching to high-priority mode.\nAwaiting your direct commands.');
            }
        }

        // Simulate real-time updates
        setInterval(() => {
            const metrics = document.querySelectorAll('.text-2xl.font-bold');
            metrics.forEach(metric => {
                if (metric.textContent.includes('¬£')) return;
                let current = parseInt(metric.textContent) || 0;
                if (Math.random() > 0.7) {
                    metric.textContent = current + Math.floor(Math.random() * 3);
                }
            });
        }, 10000);

        // TaskBar functionality
        let tasks = [
            { id: 1, title: "Wire AI Chat to CEO Office", status: "In Progress" },
            { id: 2, title: "Replicate Gas Checker", status: "Queued" },
            { id: 3, title: "Mirror QuickBooks", status: "Queued" },
            { id: 4, title: "Implement Speech Recognition", status: "In Progress" },
            { id: 5, title: "Setup Voice Synthesis", status: "Done" },
            { id: 6, title: "Optimize Database Queries", status: "Queued" },
            { id: 7, title: "Update Security Protocols", status: "In Progress" },
            { id: 8, title: "Migrate Legacy Systems", status: "Queued" },
            { id: 9, title: "Deploy Mobile Interface", status: "Done" },
            { id: 10, title: "Enhance AI Capabilities", status: "In Progress" }
        ];

        function getStatusClass(status) {
            switch(status) {
                case "Done":
                    return "bg-green-600 bg-opacity-20 text-green-400";
                case "In Progress":
                    return "bg-yellow-600 bg-opacity-20 text-yellow-400";
                default:
                    return "bg-gray-600 bg-opacity-20 text-gray-300";
            }
        }

        function renderTasks() {
            const taskList = document.getElementById('taskList');
            if (!taskList) return;

            taskList.innerHTML = tasks.map(task => `
                <li class="flex justify-between items-center p-3 rounded-xl bg-gray-700 border border-gray-600">
                    <span class="text-white">${task.title}</span>
                    <span class="px-2 py-1 text-sm rounded-xl ${getStatusClass(task.status)}">
                        ${task.status}
                    </span>
                </li>
            `).join('');
        }

        // Load tasks from backend
        async function loadTasksFromBackend() {
            try {
                const response = await api.call('ceoOffice', '/tasks');
                if (response.success && response.tasks) {
                    tasks = response.tasks;
                    renderTasks();
                    console.log('Tasks loaded from backend:', response.tasks);
                } else {
                    console.log('Using default tasks - backend not available');
                    renderTasks();
                }
            } catch (error) {
                console.log('Using default tasks - API error:', error);
                renderTasks();
            }
        }

        // Initialize TaskBar when page loads
        document.addEventListener('DOMContentLoaded', () => {
            loadTasksFromBackend();
            // Refresh tasks every 30 seconds
            setInterval(loadTasksFromBackend, 30000);
            
            // Simulate task progress updates every 60 seconds for demo
            setInterval(() => {
                if (Math.random() > 0.7) {
                    simulateTaskProgress();
                }
            }, 60000);
        });

        // Simulate task progress for demonstration
        function simulateTaskProgress() {
            const inProgressTasks = tasks.filter(task => task.status === "In Progress");
            const queuedTasks = tasks.filter(task => task.status === "Queued");
            
            if (inProgressTasks.length > 0 && Math.random() > 0.5) {
                // Complete an in-progress task
                inProgressTasks[0].status = "Done";
                console.log(`Task completed: ${inProgressTasks[0].title}`);
            }
            
            if (queuedTasks.length > 0 && Math.random() > 0.5) {
                // Start a queued task
                queuedTasks[0].status = "In Progress";
                console.log(`Task started: ${queuedTasks[0].title}`);
            }
            
            renderTasks();
        }

        // Rebecca AI Chat functionality
        let messages = [];
        let lastAssistantMessage = '';
        let autoSpeak = false;
        let recognition = null;
        let isListening = false;

        // Initialize speech recognition if available
        if ('webkitSpeechRecognition' in window || 'SpeechRecognition' in window) {
            const SpeechRecognition = window.SpeechRecognition || window.webkitSpeechRecognition;
            recognition = new SpeechRecognition();
            recognition.continuous = false;
            recognition.interimResults = false;
            recognition.lang = 'en-US';

            recognition.onstart = function() {
                isListening = true;
                document.getElementById('voiceButton').textContent = 'üî¥';
                document.getElementById('voiceButton').classList.add('bg-red-600');
                document.getElementById('voiceButton').classList.remove('bg-green-600');
            };

            recognition.onresult = function(event) {
                const transcript = event.results[0][0].transcript;
                document.getElementById('chatInput').value = transcript;
                sendMessage();
            };

            recognition.onend = function() {
                isListening = false;
                document.getElementById('voiceButton').textContent = 'üé§';
                document.getElementById('voiceButton').classList.remove('bg-red-600');
                document.getElementById('voiceButton').classList.add('bg-green-600');
            };

            recognition.onerror = function(event) {
                console.error('Speech recognition error:', event.error);
                isListening = false;
                document.getElementById('voiceButton').textContent = 'üé§';
                document.getElementById('voiceButton').classList.remove('bg-red-600');
                document.getElementById('voiceButton').classList.add('bg-green-600');
            };
        }

        async function sendMessage() {
            const input = document.getElementById('chatInput');
            const chatMessages = document.getElementById('chatMessages');
            
            if (!input.value.trim()) return;

            const userMessage = input.value.trim();
            
            // Add user message to chat
            const userDiv = document.createElement('div');
            userDiv.className = 'mb-1 text-right';
            userDiv.innerHTML = `<span class="text-gray-800">${userMessage}</span>`;
            chatMessages.appendChild(userDiv);

            // Simulate API call to Rebecca
            try {
                const response = await simulateRebeccaResponse(userMessage);
                
                // Add Rebecca's response
                const assistantDiv = document.createElement('div');
                assistantDiv.className = 'mb-1 text-left text-blue-700';
                assistantDiv.innerHTML = `<span>${response}</span>`;
                chatMessages.appendChild(assistantDiv);
                
                lastAssistantMessage = response;
                
                // Auto-scroll to bottom
                chatMessages.scrollTop = chatMessages.scrollHeight;
                
                // Speak response if auto-speak is enabled
                if (autoSpeak) {
                    speakText(response);
                }
                
            } catch (error) {
                console.error('Chat error:', error);
                const errorDiv = document.createElement('div');
                errorDiv.className = 'mb-1 text-left text-red-600';
                errorDiv.innerHTML = `<span>Sorry, I'm having trouble responding right now.</span>`;
                chatMessages.appendChild(errorDiv);
            }
            
            input.value = '';
        }

        async function simulateRebeccaResponse(message) {
            // Simulate API delay
            await new Promise(resolve => setTimeout(resolve, 1000));
            
            const responses = [
                "I've analyzed the current business metrics and everything looks good. Revenue is up 12% this month.",
                "I can help you prioritize those tasks. The gas checker replication seems most urgent.",
                "Based on the office performance data, Communications is running at 92% efficiency - excellent work by Stacy.",
                "I notice there are some pending tasks in the system. Would you like me to escalate them?",
                "The migration from QuickBooks is proceeding well. Philip has everything under control.",
                "Our AI systems are performing optimally across all offices. No issues detected.",
                "I can schedule a meeting with any of the office managers if needed.",
                "The security protocols are all up to date. All API keys are properly managed.",
                "Revenue projections look strong for next quarter based on current trends.",
                "I'm monitoring all office activities. Everything is running smoothly."
            ];
            
            // Simple keyword-based responses
            const lowerMessage = message.toLowerCase();
            if (lowerMessage.includes('task') || lowerMessage.includes('todo')) {
                return "I see you have several tasks in progress. The AI chat integration and speech recognition are moving along well. Would you like me to check on any specific task status?";
            } else if (lowerMessage.includes('revenue') || lowerMessage.includes('money') || lowerMessage.includes('finance')) {
                return "Current revenue is ¬£4,230 MTD, which is 8% above target. Philip in Accounts has all the detailed financial reports ready for your review.";
            } else if (lowerMessage.includes('office') || lowerMessage.includes('performance')) {
                return "All offices are performing well. Communications leads at 92%, Virtual Engineer at 88%, IT at 85%, and Accounts at 78%. Would you like detailed metrics for any specific office?";
            } else if (lowerMessage.includes('emergency') || lowerMessage.includes('urgent')) {
                return "I don't see any urgent issues right now. All systems are green and operating normally. I'll alert you immediately if anything changes.";
            }
            
            return responses[Math.floor(Math.random() * responses.length)];
        }

        function speakText(text) {
            if ('speechSynthesis' in window) {
                // Cancel any ongoing speech
                speechSynthesis.cancel();
                
                const utterance = new SpeechSynthesisUtterance(text);
                utterance.rate = 0.8;
                utterance.pitch = 1;
                utterance.volume = 0.8;
                
                // Try to use a female voice for Rebecca
                const voices = speechSynthesis.getVoices();
                const femaleVoice = voices.find(voice => 
                    voice.name.toLowerCase().includes('female') || 
                    voice.name.toLowerCase().includes('woman') ||
                    voice.name.toLowerCase().includes('zira') ||
                    voice.name.toLowerCase().includes('susan')
                );
                
                if (femaleVoice) {
                    utterance.voice = femaleVoice;
                }
                
                speechSynthesis.speak(utterance);
            }
        }

        function toggleSpeech() {
            autoSpeak = !autoSpeak;
            const button = document.getElementById('toggleSpeechButton');
            if (autoSpeak) {
                button.textContent = 'üîä Auto-speak: ON';
                button.classList.remove('bg-gray-600', 'hover:bg-gray-700');
                button.classList.add('bg-green-600', 'hover:bg-green-700');
            } else {
                button.textContent = 'üîá Auto-speak: OFF';
                button.classList.remove('bg-green-600', 'hover:bg-green-700');
                button.classList.add('bg-gray-600', 'hover:bg-gray-700');
            }
        }

        function startVoiceInput() {
            if (recognition && !isListening) {
                recognition.start();
            } else if (!recognition) {
                alert('Speech recognition is not supported in your browser. Please use Chrome or Edge for voice input.');
            }
        }

        // Initialize TaskBar and Chat when page loads
        document.addEventListener('DOMContentLoaded', () => {
            loadTasksFromBackend();
            // Refresh tasks every 30 seconds
            setInterval(loadTasksFromBackend, 30000);
            
            // Simulate task progress updates every 60 seconds for demo
            setInterval(() => {
                if (Math.random() > 0.7) {
                    simulateTaskProgress();
                }
            }, 60000);

            // Chat event listeners
            document.getElementById('sendButton').addEventListener('click', sendMessage);
            document.getElementById('chatInput').addEventListener('keypress', function(e) {
                if (e.key === 'Enter') {
                    sendMessage();
                }
            });
            document.getElementById('voiceButton').addEventListener('click', startVoiceInput);
            document.getElementById('speakButton').addEventListener('click', () => {
                if (lastAssistantMessage) {
                    speakText(lastAssistantMessage);
                }
            });
            document.getElementById('toggleSpeechButton').addEventListener('click', toggleSpeech);
        });
    </script>
</body>
</html>
