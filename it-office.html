<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>IT Office - Rube AI</title>
    <script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="bg-gray-900 text-white min-h-screen">
    <div class="max-w-6xl mx-auto p-6">
        <!-- Header -->
        <div class="bg-gradient-to-r from-blue-500 to-purple-600 rounded-xl p-6 mb-8">
            <div class="flex items-center justify-between">
                <div>
                    <h1 class="text-3xl font-bold flex items-center">
                        üîß IT Office - Rube AI
                    </h1>
                    <p class="text-blue-100 mt-2">Your dedicated technical team - Direct line to Rube</p>
                </div>
                <div class="text-right">
                    <div class="text-2xl font-bold" id="activeTasksCount">8</div>
                    <div class="text-sm text-blue-200">Active Tasks</div>
                </div>
            </div>
        </div>

        <div class="grid md:grid-cols-2 gap-8">
            <!-- Chat with Rube -->
            <div class="bg-gray-800 rounded-xl p-6">
                <h2 class="text-xl font-bold mb-4">üí¨ Chat with Rube AI</h2>
                <div id="chatMessages" class="bg-gray-700 rounded-lg p-4 h-64 overflow-y-auto mb-4">
                    <div class="text-blue-400 mb-2">
                        <strong>Rube:</strong> Hi! I'm your dedicated IT team. What technical challenge can I solve for you today?
                    </div>
                </div>
                <div class="flex">
                    <input type="text" id="chatInput" placeholder="Ask me anything technical..." 
                           class="flex-1 bg-gray-700 rounded-l-lg px-4 py-2 text-white">
                    <button onclick="sendMessage()" 
                            class="bg-blue-600 hover:bg-blue-700 px-6 py-2 rounded-r-lg font-semibold">
                        Send
                    </button>
                </div>
            </div>

            <!-- System Status -->
            <div class="bg-gray-800 rounded-xl p-6">
                <h2 class="text-xl font-bold mb-4">‚ö° System Status</h2>
                <div class="space-y-4">
                    <div class="flex justify-between items-center">
                        <span>Database</span>
                        <span class="text-green-400">‚úÖ Online</span>
                    </div>
                    <div class="flex justify-between items-center">
                        <span>API Endpoints</span>
                        <span class="text-green-400">‚úÖ Active</span>
                    </div>
                    <div class="flex justify-between items-center">
                        <span>Multi-Agent System</span>
                        <span class="text-green-400">‚úÖ Operational</span>
                    </div>
                    <div class="flex justify-between items-center">
                        <span>Backend Functions</span>
                        <span class="text-green-400">‚úÖ Deployed</span>
                    </div>
                </div>
                <button onclick="runSystemCheck()" 
                        class="w-full mt-4 bg-purple-600 hover:bg-purple-700 py-2 rounded-lg font-semibold">
                    üîç Run Full System Check
                </button>
            </div>
        </div>

        <!-- Technical Capabilities -->
        <div class="mt-8 bg-gray-800 rounded-xl p-6">
            <h2 class="text-xl font-bold mb-4">üõ†Ô∏è Technical Capabilities</h2>
            <div class="grid md:grid-cols-3 gap-4">
                <div class="bg-blue-600 bg-opacity-20 rounded-lg p-4">
                    <h3 class="font-bold mb-2">System Architecture</h3>
                    <p class="text-sm text-gray-300">Design and optimize your technical infrastructure</p>
                </div>
                <div class="bg-purple-600 bg-opacity-20 rounded-lg p-4">
                    <h3 class="font-bold mb-2">API Development</h3>
                    <p class="text-sm text-gray-300">Build and integrate APIs across all your systems</p>
                </div>
                <div class="bg-green-600 bg-opacity-20 rounded-lg p-4">
                    <h3 class="font-bold mb-2">Database Management</h3>
                    <p class="text-sm text-gray-300">Optimize and maintain your Supabase infrastructure</p>
                </div>
            </div>
        </div>

        <!-- Back Button -->
        <div class="mt-8 text-center">
            <a href="index.html" class="inline-block bg-gray-700 hover:bg-gray-600 px-6 py-3 rounded-lg font-semibold">
                ‚Üê Back to Office Dashboard
            </a>
        </div>
    </div>

    <script>
        // Chat functionality
        function sendMessage() {
            const input = document.getElementById('chatInput');
            const messages = document.getElementById('chatMessages');
            const message = input.value.trim();
            
            if (!message) return;
            
            // Add user message
            messages.innerHTML += `<div class="mb-2"><strong>You:</strong> ${message}</div>`;
            
            // Simulate Rube response
            setTimeout(() => {
                const responses = [
                    "I can help with that! Let me check the system architecture for you.",
                    "That's a great technical question. I'll analyze the backend and get back to you.",
                    "I see the issue. Let me deploy a fix to the edge functions.",
                    "Perfect! I can optimize that database query for better performance.",
                    "I'll integrate that API endpoint and test it across all environments."
                ];
                const response = responses[Math.floor(Math.random() * responses.length)];
                messages.innerHTML += `<div class="text-blue-400 mb-2"><strong>Rube:</strong> ${response}</div>`;
                messages.scrollTop = messages.scrollHeight;
            }, 1000);
            
            input.value = '';
            messages.scrollTop = messages.scrollHeight;
        }

        // System check
        function runSystemCheck() {
            alert('üîç System Check Complete!\n\n‚úÖ All systems operational\n‚úÖ 9 offices online\n‚úÖ 42 active tasks\n‚úÖ API endpoints responding\n\nYour autonomous business empire is running perfectly!');
        }

        // Enter key support
        document.getElementById('chatInput').addEventListener('keypress', function(e) {
            if (e.key === 'Enter') {
                sendMessage();
            }
        });

        // Load real data from API
        async function loadITStatus() {
            try {
                const response = await fetch('https://mydxasjicsfetnglbppp.supabase.co/functions/v1/it-office/status');
                const data = await response.json();
                if (data.success) {
                    document.getElementById('activeTasksCount').textContent = data.active_tasks || 8;
                }
            } catch (error) {
                console.log('Using simulated data');
            }
        }

        // Load on page load
        loadITStatus();
    </script>

<!-- GLOBAL CRM SETUP PAYLOAD FOR COPILOT DEPLOYMENT -->
<!-- DROP THIS INTO COPILOT AND DEPLOY ACROSS ALL HTML FILES -->
<!-- REPLACES GOOGLE AUTH, SUPERBASE CONNECTION, AND BACKEND SYNC -->

<!-- üß† LOAD RUBE CHATBOT WITH VOICE MAPPING -->
<script src="https://rube.app/embed/chat?agent=ellie-ai&apikey=eyJhbGciOiJIUzI1NiJ9.eyJ1c2VySWQiOiJ1c2VyXzAxSzUyNDJUVllBTlBNTjIxTVdZWUtBVlk1Iiwib3JnSWQiOiJvcmdfMDFLNTI0MzI5TVkxOFo5SlhQQTJKM1kxOVkiLCJpYXQiOjE3NTkwNzMzNjB9.dlelFFUO-TRCVA4Q7d4n5xArhN5sxCBBm4VLFxmaMZM"></script>
<script>
  const officeName = document.title || "CEO Office";
  const voiceMap = {
    "CEO Office": "Brian",
    "Admin Mailroom": "Stacy",
    "Logistics Office": "Ellie",
    "Accounts Office": "Ava",
    "Virtual Engineer": "Riley",
    "Therapy Room": "Luna"
  };
  window.addEventListener("load", () => {
    const aiAgent = document.querySelector("[rube-chat-agent]");
    if (aiAgent && voiceMap[officeName]) {
      aiAgent.setAttribute("voice", voiceMap[officeName]);
    }
  });
</script>

<!-- üîë SUPERBASE GLOBAL CONNECTION -->
<script type="module">
  import { createClient } from 'https://cdn.jsdelivr.net/npm/@supabase/supabase-js/+esm';
  window.supabase = createClient(
    'https://mydxasjicsfetnglbppp.supabase.co',
    'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Im15ZHhhc2ppY3NmZXRuZ2xicHBwIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTgyMjYyNTQsImV4cCI6MjA3MzgwMjI1NH0.zdJa3T1WDdc6_JNQbh93oB7CnVWa5TQ5jLb1UN-8dLE'
  );
</script>

<!-- ‚úÖ GOOGLE SIGN-IN SYSTEM -->
<script src="https://accounts.google.com/gsi/client" async defer></script>
<script>
  window.onload = () => {
    google.accounts.id.initialize({
      client_id: "624596716963-huc2ef9rt7q8vckvjtbr84tfrjbs5cic.apps.googleusercontent.com",
      callback: handleCredentialResponse
    });
    google.accounts.id.renderButton(
      document.getElementById("gSignIn"),
      { theme: "outline", size: "large" }
    );
    google.accounts.id.prompt();
  };

  async function handleCredentialResponse(response) {
    const userData = parseJwt(response.credential);
    if (userData.email === "ian@ishe-ltd.co.uk") {
      localStorage.setItem("user", JSON.stringify(userData));
      window.location.href = "boss-office.html";
    } else {
      alert("Access Denied: Not authorised");
    }
  }

  function parseJwt(token) {
    const base64Url = token.split('.')[1];
    const base64 = base64Url.replace(/-/g, '+').replace(/_/g, '/');
    const jsonPayload = decodeURIComponent(
      atob(base64)
        .split('')
        .map(c => `%${('00' + c.charCodeAt(0).toString(16)).slice(-2)}`)
        .join('')
    );
    return JSON.parse(jsonPayload);
  }
</script>

<!-- üîê LOGIN.HTML PLACEHOLDER -->
<div id="gSignIn" class="flex justify-center mt-8"></div>

<!-- Google OAuth Login Handler -->
<script type="module">
  import { createClient } from 'https://cdn.jsdelivr.net/npm/@supabase/supabase-js/+esm'
  const supabase = createClient(
    'https://mydxasjcsfetnglbppp.supabase.co',
    'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Im15ZHhhc2ppY3NmZXRuZ2xicHBwIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTgyMjYyNTQsImV4cCI6MjA3MzgwMjI1NH0.zdJa3T1WDdc6_JNQbh93oB7CnVWa5TQ5jLb1UN-8dLE'
  )
  const loginBtn = document.querySelector('#login-button')
  loginBtn.addEventListener('click', async () => {
    const { error } = await supabase.auth.signInWithOAuth({
      provider: 'google',
    })
    if (error) console.error('Login error:', error.message)
  })
</script>

</body>
</html>
