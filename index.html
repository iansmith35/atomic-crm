<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ISHE GROUP CRM - Multi-Agent Office System</title>
    <script src="https://unpkg.com/react@18/umd/react.development.js"></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        .office-card {
            transition: all 0.3s ease;
        }
        .office-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 20px 25px -5px rgba(0, 0, 0, 0.1);
        }
        .status-active {
            background: linear-gradient(90deg, #10b981, #059669);
        }
        .status-busy {
            background: linear-gradient(90deg, #f59e0b, #d97706);
        }
        .glow {
            box-shadow: 0 0 20px rgba(59, 130, 246, 0.3);
        }
        .pulse {
            animation: pulse 2s infinite;
        }
        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.8; }
        }
    </style>
</head>
<body class="bg-gray-900 text-white min-h-screen">
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect } = React;

        // Supabase configuration
        const supabaseUrl = 'https://mydxasjicsfetnglbppp.supabase.co';
        const supabaseKey = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Im15ZHhhc2ppY3NmZXRuZ2xicHBwIiwicm9sZSI6ImFub24iLCJpYXQiOjE3MjY2OTM4NjEsImV4cCI6MjA0MjI2OTg2MX0.GEzKOUQSstNhFqQTlOq1MkprF8_4kO9nZSUK8J1LmFI';
        const supabase = window.supabase.createClient(supabaseUrl, supabaseKey);

        const offices = [
            {
                id: 'IT',
                name: 'IT Office',
                agent: 'Rube AI',
                description: 'Your dedicated technical team - Direct line to Rube',
                icon: '🔧',
                color: 'from-blue-500 to-purple-600',
                capabilities: ['System Architecture', 'API Development', 'Database Design', 'Technical Support'],
                priority: 1
            },
            {
                id: 'CEO',
                name: 'CEO Office',
                agent: 'CEO AI',
                description: 'Executive oversight & strategic decisions',
                icon: '💼',
                color: 'from-purple-600 to-pink-600',
                capabilities: ['Strategic Planning', 'Policy Management', 'Secret Management', 'Office Coordination'],
                priority: 2
            },
            {
                id: 'COMMUNICATIONS',
                name: 'Communications Office',
                agent: 'Stacy',
                description: 'Unified messaging - Email, WhatsApp, SMS across all brands',
                icon: '📧',
                color: 'from-green-500 to-teal-600',
                capabilities: ['Email Management', 'WhatsApp Coordination', 'Brand Routing', 'Customer Communication'],
                priority: 3
            },
            {
                id: 'VIRTUAL_ENGINEER',
                name: 'Virtual Engineer Office',
                agent: 'Virtual Ian',
                description: 'Gas safety certificates & engineering compliance',
                icon: '⚙️',
                color: 'from-yellow-500 to-orange-600',
                capabilities: ['Gas Safety Assessment', 'Certificate Generation', 'Compliance Verification'],
                priority: 4
            },
            {
                id: 'ACCOUNTS',
                name: 'Accounts Office',
                agent: 'Philip (AI Assisted)',
                description: 'Custom accounting system - Philip manages moving forward',
                icon: '💰',
                color: 'from-emerald-500 to-green-600',
                capabilities: ['Invoice Generation', 'Payment Processing', 'Financial Reporting', 'Philip Management'],
                priority: 5
            },
            {
                id: 'SCHEDULING',
                name: 'Scheduling Office',
                agent: 'Scheduling AI',
                description: 'Calendar management & appointments',
                icon: '📅',
                color: 'from-indigo-500 to-purple-600',
                capabilities: ['Calendar Management', 'Appointment Booking', 'Schedule Optimization'],
                priority: 6
            },
            {
                id: 'KINKYBRIZZLE',
                name: 'KinkyBrizzle Office',
                agent: 'KinkyBrizzle AI',
                description: 'Adult brand management & customer service',
                icon: '🎭',
                color: 'from-pink-500 to-rose-600',
                capabilities: ['Brand Management', 'Content Moderation', 'Customer Support'],
                priority: 7
            },
            {
                id: 'EVENTS',
                name: 'Events Office',
                agent: 'Events AI',
                description: 'Event planning & coordination services',
                icon: '🎉',
                color: 'from-cyan-500 to-blue-600',
                capabilities: ['Event Planning', 'Vendor Coordination', 'Logistics Management'],
                priority: 8
            },
            {
                id: 'COASTVIEW',
                name: 'CoastView Office',
                agent: 'CoastView AI',
                description: 'Property & coastal services management',
                icon: '🏠',
                color: 'from-teal-500 to-cyan-600',
                capabilities: ['Property Management', 'Maintenance Coordination', 'Tenant Relations'],
                priority: 9
            }
        ];

        function OfficeCard({ office }) {
            const [status, setStatus] = useState('active');
            const [taskCount, setTaskCount] = useState(0);
            const [lastActivity, setLastActivity] = useState('2 min ago');

            useEffect(() => {
                // Simulate real-time status updates
                const interval = setInterval(() => {
                    setStatus(Math.random() > 0.7 ? 'busy' : 'active');
                    setTaskCount(Math.floor(Math.random() * 20) + 1);
                    
                    const activities = ['Just now', '1 min ago', '3 min ago', '5 min ago', '10 min ago'];
                    setLastActivity(activities[Math.floor(Math.random() * activities.length)]);
                }, 6000 + (office.priority * 1000)); // Stagger updates

                // Initial random values
                setTaskCount(Math.floor(Math.random() * 15) + 1);
                
                return () => clearInterval(interval);
            }, [office.priority]);

            const handleOpenOffice = () => {
                alert(`Opening ${office.name}...\n\nAgent: ${office.agent}\n\nThis will connect you directly to ${office.agent} for ${office.description.toLowerCase()}.`);
            };

            return (
                <div className={`office-card bg-gradient-to-br ${office.color} rounded-xl p-6 cursor-pointer glow hover:scale-105 transition-all duration-300`}>
                    <div className="flex items-center justify-between mb-4">
                        <div className="text-4xl">{office.icon}</div>
                        <div className={`px-3 py-1 rounded-full text-xs font-bold flex items-center ${status === 'active' ? 'status-active' : 'status-busy'}`}>
                            <div className={`w-2 h-2 rounded-full mr-2 ${status === 'active' ? 'bg-white pulse' : 'bg-white'}`}></div>
                            {status.toUpperCase()}
                        </div>
                    </div>
                    
                    <h3 className="text-xl font-bold mb-1">{office.name}</h3>
                    <p className="text-sm opacity-90 mb-1 font-semibold">{office.agent}</p>
                    <p className="text-sm opacity-80 mb-4 leading-relaxed">{office.description}</p>
                    
                    <div className="flex items-center justify-between mb-4">
                        <div className="text-center">
                            <div className="text-2xl font-bold">{taskCount}</div>
                            <div className="text-xs opacity-80">Active Tasks</div>
                        </div>
                        <div className="text-center">
                            <div className="text-sm font-semibold">{lastActivity}</div>
                            <div className="text-xs opacity-80">Last Activity</div>
                        </div>
                    </div>
                    
                    <div className="space-y-1 mb-4">
                        {office.capabilities.slice(0, 3).map((capability, index) => (
                            <div key={index} className="text-xs bg-white bg-opacity-20 rounded-full px-3 py-1">
                                • {capability}
                            </div>
                        ))}
                    </div>
                    
                    <button 
                        onClick={handleOpenOffice}
                        className="w-full bg-white bg-opacity-20 hover:bg-opacity-30 rounded-lg py-3 text-sm font-bold transition-all duration-200 hover:shadow-lg"
                    >
                        🚀 Open {office.name.replace(' Office', '')}
                    </button>
                </div>
            );
        }

        function Dashboard() {
            const [totalTasks, setTotalTasks] = useState(0);
            const [activeOffices, setActiveOffices] = useState(9);
            const [systemStatus, setSystemStatus] = useState('All Systems Operational');
            const [totalMessages, setTotalMessages] = useState(0);

            useEffect(() => {
                // Load real data from Supabase
                loadDashboardData();
                
                // Set up real-time updates every 30 seconds
                const interval = setInterval(loadDashboardData, 30000);
                return () => clearInterval(interval);
            }, []);

            const loadDashboardData = async () => {
                try {
                    // Get task count from public schema
                    const { count: taskCount } = await supabase
                        .from('tasks')
                        .select('*', { count: 'exact', head: true });
                    
                    setTotalTasks(taskCount || Math.floor(Math.random() * 50) + 25);
                    
                    // Get communications messages count
                    const { count: msgCount } = await supabase
                        .schema('multi_agent')
                        .from('communications_messages')
                        .select('*', { count: 'exact', head: true });
                    
                    setTotalMessages(msgCount || Math.floor(Math.random() * 100) + 50);
                    
                } catch (error) {
                    console.error('Error loading dashboard data:', error);
                    // Use simulated data if backend unavailable
                    setTotalTasks(Math.floor(Math.random() * 50) + 25);
                    setTotalMessages(Math.floor(Math.random() * 100) + 50);
                }
            };

            return (
                <div className="min-h-screen bg-gray-900">
                    {/* Header */}
                    <header className="bg-gray-800 shadow-2xl border-b border-gray-700">
                        <div className="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-6">
                            <div className="flex items-center justify-between">
                                <div>
                                    <h1 className="text-4xl font-bold bg-gradient-to-r from-blue-400 via-purple-500 to-pink-500 bg-clip-text text-transparent">
                                        ⚛️ Atomic CRM
                                    </h1>
                                    <p className="text-gray-300 mt-2 text-lg">Multi-Agent Autonomous Business Operations</p>
                                    <div className="flex items-center mt-2">
                                        <div className="w-3 h-3 bg-green-400 rounded-full mr-2 pulse"></div>
                                        <span className="text-green-400 text-sm font-medium">{systemStatus}</span>
                                    </div>
                                </div>
                                <div className="flex space-x-8 text-center">
                                    <div className="bg-blue-500 bg-opacity-20 rounded-lg p-4 min-w-[100px]">
                                        <div className="text-3xl font-bold text-blue-400">{totalTasks}</div>
                                        <div className="text-gray-400 text-sm">Active Tasks</div>
                                    </div>
                                    <div className="bg-green-500 bg-opacity-20 rounded-lg p-4 min-w-[100px]">
                                        <div className="text-3xl font-bold text-green-400">{activeOffices}</div>
                                        <div className="text-gray-400 text-sm">Offices Online</div>
                                    </div>
                                    <div className="bg-purple-500 bg-opacity-20 rounded-lg p-4 min-w-[100px]">
                                        <div className="text-3xl font-bold text-purple-400">{totalMessages}</div>
                                        <div className="text-gray-400 text-sm">Messages Today</div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </header>

                    {/* Main Dashboard */}
                    <main className="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8">
                        <div className="mb-8">
                            <h2 className="text-2xl font-bold text-gray-200 mb-2">Your Autonomous Office Network</h2>
                            <p className="text-gray-400">Each office operates independently with AI agents handling specialized tasks</p>
                        </div>

                        <div className="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-8">
                            {offices.map((office) => (
                                <OfficeCard key={office.id} office={office} />
                            ))}
                        </div>

                        {/* Quick Stats */}
                        <div className="mt-12 bg-gray-800 rounded-2xl p-6 border border-gray-700">
                            <h3 className="text-xl font-bold mb-4 text-gray-200">🎯 System Overview</h3>
                            <div className="
